-(BOOL) respondsToSelector: selector åˆ¤è¯»å®ä¾‹æ˜¯å¦æœ‰è¿™æ ·æ–¹æ³•
+(BOOL) instancesRespondToSelector:Â  åˆ¤æ–­ç±»æ˜¯å¦æœ‰è¿™ä¸ªæ–¹æ³•ã€‚æ­¤æ–¹æ³•æ˜¯ç±»æ–¹æ³•ï¼Œä¸èƒ½ç”¨åœ¨ç±»çš„å¯¹è±¡


å¯¹è±¡åœ¨è¿è¡Œæ—¶è·å–å…¶ç±»å‹çš„èƒ½åŠ›ç§°ä¸ºå†…çœã€‚å†…çœå¯ä»¥æœ‰å¤šç§æ–¹æ³•å®ç°ã€‚
åˆ¤æ–­å¯¹è±¡ç±»å‹
-(BOOL) isKindOfClass: classObjåˆ¤æ–­æ˜¯å¦æ˜¯è¿™ä¸ªç±»æˆ–è€…è¿™ä¸ªç±»çš„å­ç±»çš„å®ä¾‹
-(BOOL) isMemberOfClass: classObj åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹

performSelectorè°ƒç”¨ï¼š

   [self performSelector:@selector(CallBack0)];
   [self performSelector:@selector(CallBack1:) withObject:1];
   [self performSelector:@selector(CallBack2:b:) withObject:1 withObject:2];

æ ¹æ®å‡½æ•°ååŠ¨æ€è°ƒç”¨ï¼š

   NSString *a=@"CallBack0";
    SEL faSelector=NSSelectorFromString(a);
    [self performSelector:faSelector];
    
    NSString *b=@"CallBack1:";
    SEL fbSelector=NSSelectorFromString(b);
    [self performSelector:fbSelector withObject:1];
    
    NSString *c=@"CallBack2:b:";
    SEL fcSelector=NSSelectorFromString(c);
    [self performSelector:fcSelector withObject:1 withObject:2];

è¿™æ ·å°±å¯ä»¥æ ¹æ®å‡½æ•°åè°ƒç”¨å‡½æ•°å•¦ï¼


#define kIs_iphone (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone)
#define kIs_iPhoneX kScreenWidth >=375.0f && kScreenHeight >=812.0f&& kIs_iphone
 
/*çŠ¶æ€æ é«˜åº¦*/
#define kStatusBarHeight (CGFloat)(kIs_iPhoneX?(44.0):(20.0))
/*å¯¼èˆªæ é«˜åº¦*/
#define kNavBarHeight (44)
/*çŠ¶æ€æ å’Œå¯¼èˆªæ æ€»é«˜åº¦*/
#define kNavBarAndStatusBarHeight (CGFloat)(kIs_iPhoneX?(88.0):(64.0))
/*TabBaré«˜åº¦*/
#define kTabBarHeight (CGFloat)(kIs_iPhoneX?(49.0 + 34.0):(49.0))
/*é¡¶éƒ¨å®‰å…¨åŒºåŸŸè¿œç¦»é«˜åº¦*/
#define kTopBarSafeHeight (CGFloat)(kIs_iPhoneX?(44.0):(0))
/*åº•éƒ¨å®‰å…¨åŒºåŸŸè¿œç¦»é«˜åº¦*/
#define kBottomSafeHeight (CGFloat)(kIs_iPhoneX?(34.0):(0))
/*iPhoneXçš„çŠ¶æ€æ é«˜åº¦å·®å€¼*/
#define kTopBarDifHeight (CGFloat)(kIs_iPhoneX?(24.0):(0))
/*å¯¼èˆªæ¡å’ŒTabbaræ€»é«˜åº¦*/
#define kNavAndTabHeight (kNavBarAndStatusBarHeight + kTabBarHeight)


1ã€é—®é¢˜å±•ç¤º
å…ˆæ¥ç ä¸€ä¸‹æˆ‘èµ°è¿‡çš„å‘ï¼š
(1)æ›¿æ¢ UIImage ç±»çš„ init æ–¹æ³•

#import "UIImage+Swizzle.h"
#import <objc/message.h>

@implementation UIImage (Swizzle)

+ (void)load {
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        [self swizzleInstanceSel:@selector(init) withNewSel:@selector(qq_init)];
    });
}

+ (void)swizzleInstanceSel:(SEL)oldSel withNewSel:(SEL)newSel {
    Class class = self.class;
    Method oldM = class_getInstanceMethod(class, oldSel);
    Method newM = class_getInstanceMethod(class, newSel);
    BOOL didAdd = class_addMethod(class, oldSel, method_getImplementation(newM), method_getTypeEncoding(newM));
    if (didAdd) {
        NSLog(@"swizzleInstanceSel * didAdd");
        class_replaceMethod(class, newSel, method_getImplementation(oldM), method_getTypeEncoding(oldM));
    }
    else {
        NSLog(@"swizzleInstanceSel * didn'tAdd ----> exchange!");
        method_exchangeImplementations(oldM, newM);
    }
}

- (instancetype)qq_init {
    NSLog(@"è‡ªå®šä¹‰çš„qq_initæ–¹æ³• - %s", __func__);
    return [self qq_init];
}

@end
ç„¶ååœ¨ ViewController ç±»ä¸­è°ƒç”¨ UIImage çš„ init æ–¹æ³•ï¼šUIImage * image = [[UIImage alloc] init];ï¼Œç»“æœæ§åˆ¶å™¨çš„æ‰“å°å¦‚ä¸‹ï¼š

2018-06-15 11:00:37.155152+0800 AddMethodTest[22950:4869406] swizzleInstanceSel * didAdd
2018-06-15 11:00:37.274999+0800 AddMethodTest[22950:4869406] è‡ªå®šä¹‰çš„qq_initæ–¹æ³• - -[UIImage(Swizzle) qq_init]
ä»æ‰“å°ä¸­å¯ä»¥çœ‹å‡ºï¼Œclass_addMethod æ–¹æ³•çš„è¿”å›å€¼ didAdd ä¸ºYESï¼Œå³è°ƒç”¨äº† class_replaceMethod æ–¹æ³•ã€‚è°ƒç”¨ UIImage çš„ init æ–¹æ³•ï¼Œå®é™…ä¸Šè¿è¡Œçš„æ—¶å€™èµ°çš„æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ qq_init æ–¹æ³•ï¼Œè¾¾åˆ°æ•ˆæœï¼Œç„¶è€Œçœ‹ä¸‹é¢ğŸ‘‡

(2)æ›¿æ¢ UIImage ç±»çš„ imageNamed æ–¹æ³•

#import "UIImage+Swizzle.h"
#import <objc/message.h>

@implementation UIImage (Swizzle)

+ (void)load {
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        [self swizzleClassSel:@selector(imageNamed:) withNewSel:@selector(qq_imageNamed:)];
    });
}

+ (void)swizzleClassSel:(SEL)oldSel withNewSel:(SEL)newSel {
    Class class = self.class;
    Method oldM = class_getClassMethod(class, oldSel);
    Method newM = class_getClassMethod(class, newSel);
    BOOL didAdd = class_addMethod(class, oldSel, method_getImplementation(newM), method_getTypeEncoding(newM));
    if (didAdd) {
        NSLog(@"swizzleClassSel * didAdd");
        class_replaceMethod(class, newSel, method_getImplementation(oldM), method_getTypeEncoding(oldM));
    }
    else {
        NSLog(@"swizzleClassSel * didn'tAdd ----> exchange!");
        method_exchangeImplementations(oldM, newM);
    }
}

+ (UIImage *)qq_imageNamed:(NSString *)name {
    NSLog(@"è‡ªå®šä¹‰çš„imageNamedæ–¹æ³• - %s", __func__);
    return [self qq_imageNamed:name];
}

@end
ç„¶ååœ¨ ViewController ç±»ä¸­è°ƒç”¨ UIImage çš„ imageNamed æ–¹æ³•ï¼šUIImage * image = [UIImage imageNamed:@"1"];ï¼Œç»“æœæ§åˆ¶å™¨çš„æ‰“å°å¦‚ä¸‹ï¼š

2018-06-15 11:12:13.806120+0800 AddMethodTest[22955:4873159] swizzleClassSel * didAdd
ä»æ‰“å°ä¸­å¯ä»¥çœ‹å‡ºï¼Œclass_addMethod æ–¹æ³•çš„è¿”å›å€¼ didAdd ä¸ºYESï¼Œå³è°ƒç”¨äº† class_replaceMethod æ–¹æ³•ã€‚ä½†æ˜¯è°ƒç”¨ UIImage çš„ imageNamed æ–¹æ³•ï¼Œå®é™…ä¸Šè¿è¡Œçš„æ—¶å€™å¹¶æ²¡æœ‰èµ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ qq_imageNamed æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µï¼Ÿï¼Ÿï¼Ÿ
æˆ‘å°±å¾ˆè´¹è§£å•Šï¼ä¸ºä»€ä¹ˆç›¸åŒçš„é€»è¾‘åœ¨åŒä¸€ä¸ªç±»çš„åŒä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨çš„ç»“æœä¸ä¸€æ ·ï¼Ÿï¼Ÿ

2ã€åŸç†åˆ†æ
ç™¾æ€ä¸å¾—è§£ä¹‹åï¼Œæˆ‘ç¿»äº†ä¸€ä¸‹ç³»ç»Ÿä¸­ class_addMethod çš„æ–¹æ³•ä»‹ç»ï¼Œ

/** 
 * Adds a new method to a class with a given name and implementation.
 * 
 * @param cls The class to which to add a method.
 * @param name A selector that specifies the name of the method being added.
 * @param imp A function which is the implementation of the new method. The function must take at least two argumentsâ€”self and _cmd.
 * @param types An array of characters that describe the types of the arguments to the method. 
 * 
 * @return YES if the method was added successfully, otherwise NO 
 *  (for example, the class already contains a method implementation with that name).
 *
 * @note class_addMethod will add an override of a superclass's implementation, 
 *  but will not replace an existing implementation in this class. 
 *  To change an existing implementation, use method_setImplementation.
 */
OBJC_EXPORT BOOL
class_addMethod(Class _Nullable cls, SEL _Nonnull name, IMP _Nonnull imp, 
                const char * _Nullable types) 
    OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);
å¾ˆæ˜ç¡®ï¼Œå¦‚æœmethodæ·»åŠ æˆåŠŸå°±è¿”å›YESï¼Œå¦åˆ™è¿”å›NOï¼ˆæ¯”å¦‚ç±»ä¸­å·²ç»åŒ…å«è¿™ä¸ªæ–¹æ³•å®ç°ï¼‰ã€‚å¥½åƒå¿½ç„¶å°±æ˜ç™½äº†ï¼Œï¼Œ å®ä¾‹æ–¹æ³•çš„æ–¹æ³•åˆ—è¡¨ä¿å­˜åœ¨ç±»ä¸­ï¼Œè€Œç±»æ–¹æ³•çš„æ–¹æ³•åˆ—è¡¨ä¿å­˜åœ¨å…ƒç±»ä¸­ã€‚è¿™æ ·å¥½åƒå°±è¯´å¾—é€šäº†ã€‚
å…¶å®è¿™äº›cæ–¹æ³•æ“ä½œçš„éƒ½æ˜¯ç»“æ„ä½“ï¼Œ class_addMethodçš„ç¬¬ä¸€ä¸ªå±æ€§æ˜¯Classï¼Œæ–°å¢çš„ä¹Ÿæ˜¯è¿™ä¸ªClassé‡Œçš„æ–¹æ³•ã€‚æˆ‘è¿™é‡Œçš„ class_addMethod æ˜¯ç»™ self.classï¼ˆclass_addMethodæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ æ·»åŠ æ–¹æ³•ï¼Œå³ç»™ UIImage ç±»æ·»åŠ æ–¹æ³•ï¼Œè€Œ UIImage è¿™ä¸ªç±»ä¸­ä¿å­˜çš„éƒ½æ˜¯å®ä¾‹æ–¹æ³•ï¼Œæ•…æ­¤è¿™åœ°æ–¹çš„  class_addMethod åªèƒ½åœ¨ç»™è¿™ä¸ªç±»æ·»åŠ å®ä¾‹æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ Class ä¿å­˜çš„æ˜¯ instance çš„æ–¹æ³•ï¼Œæ‰€ä»¥åŠ çš„é‚£äº›æ–¹æ³•æœ€ç»ˆä½“ç°åœ¨å®ä¾‹ä¸Šã€‚

3ã€è§£å†³æ–¹æ³•
ææ¸…æ¥šé—®é¢˜åå°±çŸ¥é“äº†ï¼Œå¦‚æœæˆ‘æƒ³æ›¿æ¢æ‰ç±»æ–¹æ³•ï¼Œå°±è¦æŠŠç¬¬ä¸€ä¸ªå‚æ•°ç»™æ¢æˆå…ƒç±»çš„æœ¬ä½“ï¼Œå³ objc_getMetaClass(object_getClassName(self)) å°±å¯ä»¥äº†ã€‚

+ (void)swizzleClassSel:(SEL)oldSel withNewSel:(SEL)newSel {
    Class class = objc_getMetaClass(object_getClassName(self));
    Method oldM = class_getClassMethod(class, oldSel);
    Method newM = class_getClassMethod(class, newSel);
    BOOL didAdd = class_addMethod(class, oldSel, method_getImplementation(newM), method_getTypeEncoding(newM));
    if (didAdd) {
        NSLog(@"swizzleInstanceSel * didAdd");
        class_replaceMethod(class, newSel, method_getImplementation(oldM), method_getTypeEncoding(oldM));
    }
    else {
        NSLog(@"swizzleInstanceSel * didn'tAdd ----> exchange!");
        method_exchangeImplementations(oldM, newM);
    }
}
æ‰“å°ç»“æœå¦‚ä¸‹ï¼š

2018-06-15 11:41:41.630059+0800 AddMethodTest[22958:4876411]  swizzleInstanceSel * didn'tAdd ----> exchange!
2018-06-15 11:41:41.630059+0800 AddMethodTest[22958:4876411]  è‡ªå®šä¹‰çš„imageNamedæ–¹æ³• - +[UIImage(Swizzle) qq_imageNamed:]
è¿™æ ·å°±è§£é‡Šçš„é€šäº†ã€‚

PSï¼š
ç±»å’Œå…ƒç±»çš„ç»“æ„ä½“æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¾ˆå¤šå…³ç³»éƒ½æ˜¯å¯ä»¥æ¬è¿‡æ¥çš„ã€‚
å®ä¾‹-ç±»ï¼Œç±»-å…ƒç±»çš„åŒºåˆ«åœ¨äºï¼Œå®ä¾‹æ˜¯å¼€å‘newå‡ºæ¥çš„ç”¨äºæ‰¿è½½ä¸šåŠ¡ä¿¡æ¯çš„ï¼Œç±»æ˜¯ç³»ç»Ÿnewå‡ºæ¥çš„ï¼Œç”¨äºæè¿°å®ä¾‹çš„ï¼Œè¡¨é¢ä¸Šçš„ç”¨å¤„æ˜¯å¤§ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯æŒ–åˆ°æ·±å±‚ç»“æ„å°±æ˜¯é€šç”¨çš„ã€‚




- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {
    if ([self isInputRuleNotBlank:string] || [string isEqualToString:@""]) {
        return YES;
    } else {
        return NO;
    }
}

- (void)textFieldChanged:(UITextField *)textField {
    NSString *toBeString = textField.text;
    if (![self isInputRuleAndBlank:toBeString]) {
        textField.text = [self disable_emoji:toBeString];
        return;
    }
    NSString *lang = [[textField textInputMode] primaryLanguage];
    if([lang isEqualToString:@"zh-Hans"]) {
        UITextRange *selectedRange = [textField markedTextRange];
        //è·å–é«˜äº®éƒ¨åˆ†
        UITextPosition *position = [textField positionFromPosition:selectedRange.start offset:0];
        //æ²¡æœ‰é«˜äº®é€‰æ‹©çš„å­—ï¼Œåˆ™å¯¹å·²è¾“å…¥çš„æ–‡å­—è¿›è¡Œå­—æ•°ç»Ÿè®¡å’Œé™åˆ¶
        if(!position) {
            NSString *getStr = [self getSubString:toBeString];
            if(getStr && getStr.length > 0) {
                textField.text = getStr;
            }
        }
    } else{
        NSString *getStr = [self getSubString:toBeString];
        if(getStr && getStr.length > 0) {
            textField.text= getStr;
        }
    }
}
/**
 * å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡æ­£åˆ™åˆ¤æ–­ï¼ˆä¸åŒ…æ‹¬ç©ºæ ¼ï¼‰
 */
- (BOOL)isInputRuleNotBlank:(NSString *)str {
    NSString *pattern = @"^[a-zA-Z\u4E00-\u9FA5\\d]*$";
    NSPredicate *pred = [NSPredicate predicateWithFormat:@"SELF MATCHES %@", pattern];
    BOOL isMatch = [pred evaluateWithObject:str];
    return isMatch;
}
/**
 * å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡æ­£åˆ™åˆ¤æ–­ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ï¼ˆåœ¨ç³»ç»Ÿè¾“å…¥æ³•ä¸­æ–‡è¾“å…¥æ—¶ä¼šå‡ºç°æ‹¼éŸ³ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œéœ€è¦å¿½ç•¥ï¼Œå½“æŒ‰returné”®æ—¶ä¼šè‡ªåŠ¨ç”¨å­—æ¯æ›¿æ¢ï¼ŒæŒ‰ç©ºæ ¼è¾“å…¥å“åº”æ±‰å­—ï¼‰
 */
- (BOOL)isInputRuleAndBlank:(NSString *)str {
    NSString *pattern = @"^[a-zA-Z\u4E00-\u9FA5\\d\\s]*$";
    NSPredicate *pred = [NSPredicate predicateWithFormat:@"SELF MATCHES %@", pattern];
    BOOL isMatch = [pred evaluateWithObject:str];
    return isMatch;
}
/**
 *  è·å¾— kMaxLengthé•¿åº¦çš„å­—ç¬¦
 */
-(NSString *)getSubString:(NSString*)string{
    NSStringEncoding encoding = CFStringConvertEncodingToNSStringEncoding(kCFStringEncodingGB_18030_2000);
    NSData* data = [string dataUsingEncoding:encoding];
    NSInteger length = [data length];
    if (length > kMaxLength) {
        NSData *data1 = [data subdataWithRange:NSMakeRange(0, kMaxLength)];
        NSString *content = [[NSString alloc] initWithData:data1 encoding:encoding];//æ³¨æ„ï¼šå½“æˆªå–kMaxLengthé•¿åº¦å­—ç¬¦æ—¶æŠŠä¸­æ–‡å­—ç¬¦æˆªæ–­è¿”å›çš„contentä¼šæ˜¯nil
        if (!content || content.length == 0) {
            data1 = [data subdataWithRange:NSMakeRange(0, kMaxLength - 1)];
            content =  [[NSString alloc] initWithData:data1 encoding:encoding];
        }
        return content;
    }
    return nil;
}
/**
 *  è¿‡æ»¤å­—ç¬¦ä¸²ä¸­çš„emoji
 */
- (NSString *)disable_emoji:(NSString *)text{
    NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:@"[^\\u0020-\\u007E\\u00A0-\\u00BE\\u2E80-\\uA4CF\\uF900-\\uFAFF\\uFE30-\\uFE4F\\uFF00-\\uFFEF\\u0080-\\u009F\\u2000-\\u201f\r\n]"options:NSRegularExpressionCaseInsensitive error:nil];
    NSString *modifiedString = [regex stringByReplacingMatchesInString:text
                                                               options:0
                                                                 range:NSMakeRange(0, [text length])
                                                          withTemplate:@""];
    return modifiedString;
}
